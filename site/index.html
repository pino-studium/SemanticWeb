<!DOCTYPE html>
<html>

<head>
    <title>Streetory</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="script.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body>
    <header>streetory</header>
    <nav>
        <form autocomplete="off" action="index.html">
            <input type="text" id="input" list="datalist" name="strasse" placeholder="Nachmarkt">
            <datalist id="datalist"></datalist>
        </form>
    </nav>
    <section>
        <h2>Straße</h2>
        <p id="name">Naschmarkt</p>
        <h2>Erläuterung</h2>
        <p id="erlaeuterung">Traditionelle Bezeichnung für den 1556 angelegten Platz, auf dem die Händler „Zukost und
            Naschwerk, auch gesalzene Fische feilboten“. Auf den Böden über den dortigen Fleischbänken trat zwischen
            1727 und 1749 Caroline Neuber mit ihren Komödianten auf. Mit dem Bau der barocken Handelsbörse von 1678 bis
            1682 erhielt der Platz seinen nördlichen Abschluss und zugleich Bedeutung als Treffpunkt der Handelswelt.
            1908/09 entstand anstelle des historischen Burgkellers (von 1572) das Messehaus Handelshof. Der Burgkeller
            ist das älteste Gasthaus Leipzigs (1419 erstmals erwähnt). Am Naschmarkt befinden sich das 1903 von Carl
            Ludwig Seffner geschaffene Goethedenkmal und der Löwenbrunnen (1918 von Hugo Licht erneuert).</p>
        <h2>Karte</h2>
        <div id="map" class="leaflet-container leaflet-touch leaflet-fade-anim leaflet-grab" tabindex="0"></div>
        <h2>Sehenswürdigkeit</h2>
        <a id="sehenswuerdigkeit" href="https://www.leipziginfo.de/adressen/ort/alte-boerse/">Alte Börse</a>
        <img id="bild" src="https://www.leipziginfo.de/fileadmin/_processed_/e/7/csm_alte-boerse-01_d030fb277e.jpg">
    </section>
    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        let streetName = urlParams.get('strasse');
        if (streetName == null) {
            streetName = "Naschmarkt";
        }
        
        async function getStreetList() {
            const fetchstreets = await fetch("http://92.206.209.228:3030/db/query", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/sparql-query'
                },
                body: `SELECT ?object
                        WHERE {
                            ?subject ?predicate ?object .
                            FILTER(STRSTARTS(STR(?subject), "https://github.com/pino-studium/streetory-tools") && ?predicate = <http://schema.org/name> )
                        }`
            });
            const streetlist = await fetchstreets.json();
            var datalist = document.getElementById("datalist");
            for (let i = 0; i < streetlist["results"]["bindings"].length; i++) {
                var option = document.createElement('option');
                option.value = streetlist["results"]["bindings"][i]["object"]["value"];
                datalist.appendChild(option);
            }
        }
        async function setMap() {
            const response = await fetch(`https://nominatim.openstreetmap.org/search?street=${streetName}&city=Leipzig&format=jsonv2&countrycodes=de&limit=1`);
            const result = await response.json();
            let lat = result[0].lat;
            let lon = result[0].lon;
            let map = L.map('map', { zoomControl: false }).setView([lat, lon], 18);
            L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19, attribution: "OpenStreetMap" }).addTo(map);
            L.marker([lat, lon]).addTo(map);
        }
        
        document.getElementById("input").setAttribute("placeholder", streetName);
        document.getElementById("name").innerHTML = streetName;
        document.getElementById("erlaeuterung").innerHTML = streetName;
        setMap();
        document.getElementById("sehenswuerdigkeit").innerHTML = streetName;
        document.getElementById("sehenswuerdigkeit").setAttribute("href", streetName);
        document.getElementById("bild").setAttribute("src", streetName);
        getStreetList();
    </script>
</body>
</html>